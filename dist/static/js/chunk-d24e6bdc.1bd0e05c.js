(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d24e6bdc"],{"03b4":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"document-camera-container"},[e("div",{ref:"cameraView",staticClass:"camera-view"},[e("video",{ref:"video",attrs:{autoplay:"",playsinline:""}}),e("div",{staticClass:"mask-overlay"},[e("div",{staticClass:"document-frame",class:t.documentType}),e("div",{staticClass:"instruction-text"},[t._v(" "+t._s("id-card-front"===t.documentType?"请将身份证正面放入框内":"id-card-back"===t.documentType?"请将身份证背面放入框内":"driving-license"===t.documentType?"请将驾驶证放入框内":"请将证件放入框内")+" ")])]),e("button",{staticClass:"capture-button",on:{click:t.capturePhoto}},[e("div",{staticClass:"capture-icon"})])]),t.capturedImage?e("div",{staticClass:"preview-container"},[e("div",{staticClass:"preview-image"},[e("img",{attrs:{src:t.capturedImage,alt:"证件照片"}})]),e("div",{staticClass:"preview-actions"},[e("button",{staticClass:"retake-button",on:{click:t.resetCamera}},[t._v("重拍")]),e("button",{staticClass:"confirm-button",on:{click:t.confirmPhoto}},[t._v("确认")])])]):t._e(),t.capturedImage?t._e():e("div",{staticClass:"document-type-selector"},[e("div",{staticClass:"type-item",class:{active:"id-card-front"===t.documentType},on:{click:function(e){t.documentType="id-card-front"}}},[e("i",{staticClass:"fa fa-id-card-o"}),e("span",[t._v("身份证正面")])]),e("div",{staticClass:"type-item",class:{active:"id-card-back"===t.documentType},on:{click:function(e){t.documentType="id-card-back"}}},[e("i",{staticClass:"fa fa-id-card-o"}),e("span",[t._v("身份证背面")])]),e("div",{staticClass:"type-item",class:{active:"driving-license"===t.documentType},on:{click:function(e){t.documentType="driving-license"}}},[e("i",{staticClass:"fa fa-car"}),e("span",[t._v("驾驶证")])])])])},s=[],c={name:"DocumentCamera",data(){return{video:null,canvas:null,documentType:"id-card-front",capturedImage:null,stream:null}},mounted(){this.initCamera()},beforeDestroy(){this.stopCamera()},methods:{async initCamera(){try{this.video=this.$refs.video,this.canvas=document.createElement("canvas");const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});this.stream=t,this.video.srcObject=t,this.video.addEventListener("loadedmetadata",()=>{this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight})}catch(t){"NotAllowedError"===t.name||"PermissionDeniedError"===t.name?this.statusText="请授予相机访问权限":"NotFoundError"===t.name||"DevicesNotFoundError"===t.name?this.statusText="未检测到相机设备":"NotReadableError"===t.name?this.statusText="无法访问相机，请确保没有其他应用正在使用它":"SecurityError"===t.name?this.statusText="由于安全限制，无法访问相机":this.statusText="相机初始化失败，请重试",console.error("摄像头访问失败:",this.statusText)}},stopCamera(){this.stream&&(this.stream.getTracks().forEach(t=>{t.stop()}),this.stream=null)},capturePhoto(){if(!this.video)return;const t=this.canvas.getContext("2d");t.drawImage(this.video,0,0,this.canvas.width,this.canvas.height);const e=this.$refs.cameraView.querySelector(".document-frame").getBoundingClientRect(),a=this.$refs.video.getBoundingClientRect(),i=this.canvas.width/a.width,s=this.canvas.height/a.height,c=(e.left-a.left)*i,n=(e.top-a.top)*s,o=e.width*i,r=e.height*s,d=document.createElement("canvas");d.width=o,d.height=r;const u=d.getContext("2d");u.drawImage(this.canvas,c,n,o,r,0,0,o,r),this.capturedImage=d.toDataURL("image/jpeg",.9),this.stopCamera()},resetCamera(){this.capturedImage=null,this.initCamera()},confirmPhoto(){console.log("照片已确认:",this.capturedImage),this.$emit("photo-captured",this.capturedImage)}}},n=c,o=(a("5f73"),a("2877")),r=Object(o["a"])(n,i,s,!1,null,"67081e62",null);e["default"]=r.exports},"5f73":function(t,e,a){"use strict";a("a65a")},a65a:function(t,e,a){}}]);